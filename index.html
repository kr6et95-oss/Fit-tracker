<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì²´ì¤‘ ê´€ë¦¬ëŠ” ê¾¸ì¤€í•¨ì´ ë‹µì…ë‹ˆë‹¤">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FIT TRACKER">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23667eea' width='100' height='100'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white'%3EğŸ’ª%3C/text%3E%3C/svg%3E">
    <title>FIT TRACKER - ì²´ì¤‘ ê´€ë¦¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #1a1a2e;
            --accent: #ff6b6b;
            --success: #4ecdc4;
            --warning: #ffe66d;
            --bg: #f8f9fa;
            --card: #ffffff;
        }
        
        body {
            font-family: 'Nanum Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            font-family: 'Poppins', sans-serif;
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Nanum Gothic', sans-serif;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        textarea { resize: vertical; min-height: 80px; }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,107,107,0.4);
        }
        
        .btn-secondary {
            background: var(--success);
            color: white;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .meal-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .meal-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .meal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .meal-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .meal-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .meal-count {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .progress-section {
            margin: 20px 0;
        }

        .progress-item {
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .progress-label {
            font-size: 1rem;
            color: var(--primary);
        }

        .progress-values {
            font-size: 0.9rem;
            color: #666;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .progress-bar.protein {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .progress-bar.carb {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        }

        .progress-bar.fat {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        }

        .progress-bar.over {
            background: linear-gradient(90deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .remaining-text {
            margin-top: 5px;
            font-size: 0.85rem;
            color: #666;
        }

        .remaining-text.complete {
            color: var(--success);
            font-weight: 700;
        }

        .remaining-text.over {
            color: #ff6b6b;
            font-weight: 700;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .goal-box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .goal-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .goal-item {
            text-align: center;
        }
        
        .goal-label {
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 5px;
        }
        
        .goal-value {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            margin: 40px auto;
            padding: 0;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
        }
        
        .close {
            font-size: 2rem;
            cursor: pointer;
            color: white;
            background: none;
            border: none;
        }
        
        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .method-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .method-btn {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .method-btn:hover {
            border-color: var(--accent);
            transform: translateY(-3px);
        }
        
        .method-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .food-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .food-item {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .food-item:hover {
            border-color: var(--accent);
            background: #fff5f5;
        }
        
        .food-item.selected {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }
        
        .food-item-photo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .food-item-content {
            flex: 1;
        }
        
        .food-name {
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .food-info {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .added-list {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .added-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .photo-upload {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border: 2px dashed #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            margin: 20px 0;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .photo-item {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .history-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .history-date {
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 0.95rem;
        }
        
        .hidden { display: none !important; }
        
        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .meal-grid, .stats-grid, .goal-grid, .method-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ’ª FIT TRACKER</h1>
            <p class="subtitle">ì²´ì¤‘ ê´€ë¦¬ëŠ” ê¾¸ì¤€í•¨ì´ ë‹µì…ë‹ˆë‹¤</p>
        </header>

        <!-- ì„¤ì • -->
        <div id="settingsCard" class="card hidden">
            <h2>âš™ï¸ ê¸°ë³¸ ì„¤ì •</h2>
            <div class="input-group">
                <label>ì„±ë³„</label>
                <select id="gender">
                    <option value="male">ë‚¨ì„±</option>
                    <option value="female">ì—¬ì„±</option>
                </select>
            </div>
            <div class="input-group">
                <label>ë‚˜ì´</label>
                <input type="number" id="age" placeholder="25">
            </div>
            <div class="input-group">
                <label>í‚¤ (cm)</label>
                <input type="number" id="height" placeholder="175">
            </div>
            <div class="input-group">
                <label>í˜„ì¬ ì²´ì¤‘ (kg)</label>
                <input type="number" id="currentWeight" step="0.1" placeholder="70">
            </div>
            <div class="input-group">
                <label>ì²´ì§€ë°©ë¥  (%)</label>
                <input type="number" id="bodyFat" step="0.1" placeholder="20">
            </div>
            <div class="input-group">
                <label>ëª©í‘œ ì²´ì¤‘ (kg)</label>
                <input type="number" id="targetWeight" step="0.1" placeholder="65">
            </div>
            <div class="input-group">
                <label>í™œë™ ìˆ˜ì¤€</label>
                <select id="activityLevel">
                    <option value="1.2">ê±°ì˜ ì•ˆ ì›€ì§ì„ - ì‚¬ë¬´ì§, í•˜ë£¨ ì¢…ì¼ ì•‰ì•„ì„œ ì¼í•¨</option>
                    <option value="1.375">ê°€ë²¼ìš´ í™œë™ - ê°€ë” ê±·ê¸°, ì£¼ 1-2íšŒ ê°€ë²¼ìš´ ìš´ë™</option>
                    <option value="1.55" selected>ë³´í†µ í™œë™ - ì£¼ 3-4íšŒ ìš´ë™, ì§ì¥ì—ì„œ ìì£¼ ì´ë™</option>
                    <option value="1.725">í™œë°œí•œ í™œë™ - ì£¼ 5-6íšŒ ìš´ë™, ìœ¡ì²´ ë…¸ë™</option>
                    <option value="1.9">ë§¤ìš° í™œë°œ - ë§¤ì¼ ê³ ê°•ë„ ìš´ë™, ìš´ë™ì„ ìˆ˜ ìˆ˜ì¤€</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="saveSettings()">ì„¤ì • ì €ì¥</button>
        </div>

        <!-- ëª©í‘œ -->
        <div id="goalCard" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>ğŸ“Š ë‚˜ì˜ ëª©í‘œ</h2>
                <button class="btn btn-small btn-secondary" onclick="showSettings()">ìˆ˜ì •</button>
            </div>
            <div class="goal-box">
                <div class="goal-grid">
                    <div class="goal-item">
                        <div class="goal-label">í˜„ì¬</div>
                        <div class="goal-value" id="dispCurrent">-</div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-label">ëª©í‘œ</div>
                        <div class="goal-value" id="dispTarget">-</div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-label">ê°ëŸ‰</div>
                        <div class="goal-value" id="dispDiff">-</div>
                    </div>
                </div>
                <div style="text-align: center; padding-top: 15px; border-top: 2px solid rgba(0,0,0,0.1);">
                    <div class="goal-label">ì˜ˆìƒ ê¸°ê°„</div>
                    <div class="goal-value" id="dispDays" style="font-size: 1.8rem;">-</div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-box" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <div class="stat-label">ì¹¼ë¡œë¦¬</div>
                    <div class="stat-value" id="dispCal">-</div>
                </div>
                <div class="stat-box" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                    <div class="stat-label">ë‹¨ë°±ì§ˆ</div>
                    <div class="stat-value" id="dispPro">-</div>
                </div>
                <div class="stat-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    <div class="stat-label">íƒ„ìˆ˜í™”ë¬¼</div>
                    <div class="stat-value" id="dispCarb">-</div>
                </div>
            </div>
        </div>

        <!-- ì¼ì¼ ê¸°ë¡ -->
        <div id="recordCard" class="card hidden">
            <h2>ğŸ“… ì˜¤ëŠ˜ ê¸°ë¡</h2>
            <div class="input-group">
                <label>ì²´ì¤‘ (kg)</label>
                <input type="number" id="todayWeight" step="0.1" placeholder="70.5">
            </div>
            
            <label>ì‹ì‚¬ ê¸°ë¡</label>
            <div class="meal-grid">
                <div class="meal-card" onclick="openMeal('breakfast')">
                    <div class="meal-icon">ğŸ³</div>
                    <div class="meal-name">ì•„ì¹¨</div>
                    <div class="meal-count" id="breakfastCount">(0)</div>
                </div>
                <div class="meal-card" onclick="openMeal('lunch')">
                    <div class="meal-icon">ğŸ±</div>
                    <div class="meal-name">ì ì‹¬</div>
                    <div class="meal-count" id="lunchCount">(0)</div>
                </div>
                <div class="meal-card" onclick="openMeal('dinner')">
                    <div class="meal-icon">ğŸ½ï¸</div>
                    <div class="meal-name">ì €ë…</div>
                    <div class="meal-count" id="dinnerCount">(0)</div>
                </div>
                <div class="meal-card" onclick="openMeal('snack')">
                    <div class="meal-icon">ğŸª</div>
                    <div class="meal-name">ê°„ì‹</div>
                    <div class="meal-count" id="snackCount">(0)</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                <button class="btn btn-secondary" onclick="quickPhotoUpload('breakfast')" style="padding: 12px; font-size: 0.95rem;">ğŸ“¸ ì•„ì¹¨ ì‚¬ì§„</button>
                <button class="btn btn-secondary" onclick="quickPhotoUpload('lunch')" style="padding: 12px; font-size: 0.95rem;">ğŸ“¸ ì ì‹¬ ì‚¬ì§„</button>
                <button class="btn btn-secondary" onclick="quickPhotoUpload('dinner')" style="padding: 12px; font-size: 0.95rem;">ğŸ“¸ ì €ë… ì‚¬ì§„</button>
                <button class="btn btn-secondary" onclick="quickPhotoUpload('snack')" style="padding: 12px; font-size: 0.95rem;">ğŸ“¸ ê°„ì‹ ì‚¬ì§„</button>
            </div>

            <div id="photoSection" class="hidden" style="margin-top: 20px;">
                <label>ì‹ì‚¬ ì‚¬ì§„</label>
                <div class="photo-grid" id="photoGrid"></div>
            </div>

            <div class="progress-section">
                <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ¯ ì˜¤ëŠ˜ì˜ ì˜ì–‘ì†Œ ëª©í‘œ</h3>
                
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">ë‹¨ë°±ì§ˆ</span>
                        <span class="progress-values"><span id="currentPro">0</span>g / <span id="goalPro">0</span>g</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar protein" id="barPro" style="width: 0%;">
                            <span id="percentPro">0%</span>
                        </div>
                    </div>
                    <div class="remaining-text" id="remainPro">-</div>
                </div>

                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">íƒ„ìˆ˜í™”ë¬¼</span>
                        <span class="progress-values"><span id="currentCarb">0</span>g / <span id="goalCarb">0</span>g</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar carb" id="barCarb" style="width: 0%;">
                            <span id="percentCarb">0%</span>
                        </div>
                    </div>
                    <div class="remaining-text" id="remainCarb">-</div>
                </div>

                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">ì§€ë°©</span>
                        <span class="progress-values"><span id="currentFat">0</span>g / <span id="goalFat">0</span>g</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar fat" id="barFat" style="width: 0%;">
                            <span id="percentFat">0%</span>
                        </div>
                    </div>
                    <div class="remaining-text" id="remainFat">-</div>
                </div>

                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">ì´ ì¹¼ë¡œë¦¬</span>
                        <span class="progress-values"><span id="currentCal2">0</span> / <span id="goalCal2">0</span> kcal</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar protein" id="barCal" style="width: 0%;">
                            <span id="percentCal">0%</span>
                        </div>
                    </div>
                    <div class="remaining-text" id="remainCal">-</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">ì´ ì¹¼ë¡œë¦¬</div>
                    <div class="stat-value" id="totalCal">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ë‹¨ë°±ì§ˆ</div>
                    <div class="stat-value" id="totalPro">0g</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">íƒ„ìˆ˜í™”ë¬¼</div>
                    <div class="stat-value" id="totalCarb">0g</div>
                </div>
            </div>

            <div class="input-group" style="margin-top: 20px;">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="exercise" style="width: auto;">
                    <span>ì˜¤ëŠ˜ ìš´ë™í–ˆì–´ìš”! ğŸ’ª</span>
                </label>
            </div>

            <div class="input-group">
                <label>ë©”ëª¨</label>
                <textarea id="memo" placeholder="ì˜¤ëŠ˜ì˜ ê¸°ë¡..."></textarea>
            </div>

            <button class="btn btn-primary" onclick="saveRecord()">ê¸°ë¡ ì €ì¥</button>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ -->
        <div id="historyCard" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>ğŸ“Š ê¸°ë¡ íˆìŠ¤í† ë¦¬</h2>
                <button class="btn btn-small btn-secondary" onclick="clearAll()">ì „ì²´ ì‚­ì œ</button>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn btn-small" id="tabDaily" onclick="showTab('daily')" style="flex: 1; background: var(--accent); color: white;">ì¼ë³„ ê¸°ë¡</button>
                <button class="btn btn-small" id="tabWeekly" onclick="showTab('weekly')" style="flex: 1; background: #e0e0e0;">ì£¼ê°„ í†µê³„</button>
                <button class="btn btn-small" id="tabMonthly" onclick="showTab('monthly')" style="flex: 1; background: #e0e0e0;">ì›”ê°„ í†µê³„</button>
            </div>

            <div id="dailyTab">
                <div id="historyList"></div>
            </div>

            <div id="weeklyTab" class="hidden">
                <canvas id="weeklyChart" style="max-height: 300px; margin-bottom: 20px;"></canvas>
                <div id="weeklyStats"></div>
            </div>

            <div id="monthlyTab" class="hidden">
                <canvas id="monthlyChart" style="max-height: 300px; margin-bottom: 20px;"></canvas>
                <div id="monthlyStats"></div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div id="mealModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ì‹ì‚¬ ì¶”ê°€</h3>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="methodSelect">
                    <div class="method-grid">
                        <div class="method-btn" onclick="selectMethod('db')">
                            <div class="method-icon">ğŸ“‹</div>
                            <div>ìŒì‹ ì„ íƒ</div>
                        </div>
                        <div class="method-btn" onclick="selectMethod('manual')">
                            <div class="method-icon">âœï¸</div>
                            <div>ì§ì ‘ ì…ë ¥</div>
                        </div>
                    </div>
                </div>

                <div id="dbSection" class="hidden">
                    <button class="btn btn-small btn-secondary" onclick="backToMethod()" style="margin-bottom: 15px;">â† ëŒì•„ê°€ê¸°</button>
                    <div class="input-group">
                        <input type="text" id="foodSearch" placeholder="ìŒì‹ ê²€ìƒ‰..." oninput="searchFood()">
                    </div>
                    <div class="food-list" id="foodList"></div>
                    <div id="amountSection" class="hidden" style="margin-top: 15px;">
                        <div class="input-group">
                            <label>ì–‘ (g)</label>
                            <input type="number" id="foodAmount" placeholder="100">
                        </div>
                        <button class="btn btn-primary" onclick="addFood()">ì¶”ê°€</button>
                    </div>
                </div>

                <div id="manualSection" class="hidden">
                    <button class="btn btn-small btn-secondary" onclick="backToMethod()" style="margin-bottom: 15px;">â† ëŒì•„ê°€ê¸°</button>
                    <div class="input-group">
                        <label>ìŒì‹ ì´ë¦„</label>
                        <input type="text" id="manualName" placeholder="ì¹˜í‚¨ ìƒëŸ¬ë“œ">
                    </div>
                    <div class="input-group">
                        <label>ìŒì‹ ì‚¬ì§„ (ì„ íƒ)</label>
                        <input type="file" id="manualPhoto" accept="image/*" onchange="previewManualPhoto()" style="padding: 8px;">
                        <div id="manualPhotoPreview" style="margin-top: 10px;"></div>
                    </div>
                    <div class="input-group">
                        <label>ì–‘ (g)</label>
                        <input type="number" id="manualAmount" placeholder="150">
                    </div>
                    <div class="input-group">
                        <label>ì¹¼ë¡œë¦¬ (kcal)</label>
                        <input type="number" id="manualCal" placeholder="200">
                    </div>
                    <div class="input-group">
                        <label>ë‹¨ë°±ì§ˆ (g)</label>
                        <input type="number" id="manualPro" step="0.1" placeholder="20">
                    </div>
                    <div class="input-group">
                        <label>íƒ„ìˆ˜í™”ë¬¼ (g)</label>
                        <input type="number" id="manualCarb" step="0.1" placeholder="10">
                    </div>
                    <div class="input-group">
                        <label>ì§€ë°© (g)</label>
                        <input type="number" id="manualFat" step="0.1" placeholder="8">
                    </div>
                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="saveCustom" style="width: auto;">
                            <span>ë‚˜ë§Œì˜ ìŒì‹ì— ì €ì¥ (100g ê¸°ì¤€)</span>
                        </label>
                    </div>
                    <button class="btn btn-primary" onclick="addManual()">ì¶”ê°€</button>
                </div>

                <div id="addedSection" class="added-list hidden">
                    <h3 style="margin-bottom: 15px;">ì¶”ê°€ëœ ìŒì‹</h3>
                    <div id="addedList"></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="addPhoto()">ğŸ“¸ ì‚¬ì§„</button>
                        <button class="btn btn-primary" onclick="saveMeal()">ì™„ë£Œ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const foodDB = [
            {name:"ë°±ë¯¸ë°¥",cal:130,pro:2.5,carb:28,fat:0.3},
            {name:"í˜„ë¯¸ë°¥",cal:112,pro:2.6,carb:23.5,fat:0.9},
            {name:"ê³ êµ¬ë§ˆ",cal:86,pro:1,carb:20,fat:0.1},
            {name:"ê°ì",cal:77,pro:2,carb:17,fat:0.1},
            {name:"ì‹ë¹µ",cal:265,pro:8,carb:49,fat:3.5},
            {name:"ë‹­ê°€ìŠ´ì‚´",cal:165,pro:31,carb:0,fat:3.6},
            {name:"ê³„ë€",cal:155,pro:13,carb:1.1,fat:11},
            {name:"ì†Œê³ ê¸°",cal:140,pro:22,carb:0,fat:5.5},
            {name:"ë‘ë¶€",cal:76,pro:8,carb:1.9,fat:4.8},
            {name:"ìš°ìœ ",cal:61,pro:3.2,carb:4.8,fat:3.3},
            {name:"ë¸Œë¡œì½œë¦¬",cal:34,pro:2.8,carb:7,fat:0.4},
            {name:"ì‹œê¸ˆì¹˜",cal:23,pro:2.9,carb:3.6,fat:0.4},
            {name:"í† ë§ˆí† ",cal:18,pro:0.9,carb:3.9,fat:0.2},
            {name:"ë°”ë‚˜ë‚˜",cal:89,pro:1.1,carb:23,fat:0.3},
            {name:"ì‚¬ê³¼",cal:52,pro:0.3,carb:14,fat:0.2},
            {name:"ì•„ëª¬ë“œ",cal:579,pro:21,carb:22,fat:50},
        ];

        let currentMeal = '';
        let mealData = {breakfast:[],lunch:[],dinner:[],snack:[]};
        let photos = {breakfast:[],lunch:[],dinner:[],snack:[]};
        let customDB = JSON.parse(localStorage.getItem('customFoods')||'[]');
        let selected = null;
        let manualPhotoData = null;

        function quickPhotoUpload(mealType) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment';
            input.onchange = e => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = ev => {
                        photos[mealType].push(ev.target.result);
                        updatePhotos();
                        alert('ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“¸');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function previewManualPhoto() {
            const file = document.getElementById('manualPhoto').files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = e => {
                    manualPhotoData = e.target.result;
                    document.getElementById('manualPhotoPreview').innerHTML = 
                        `<img src="${manualPhotoData}" style="width: 100%; max-width: 200px; border-radius: 10px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function init() {
            const settings = JSON.parse(localStorage.getItem('settings')||'null');
            if(settings) {
                document.getElementById('settingsCard').classList.add('hidden');
                document.getElementById('goalCard').classList.remove('hidden');
                document.getElementById('recordCard').classList.remove('hidden');
                document.getElementById('historyCard').classList.remove('hidden');
                showGoals(settings);
            } else {
                document.getElementById('settingsCard').classList.remove('hidden');
            }
            loadHistory();
            updateProgress();
        }

        function saveSettings() {
            const s = {
                gender: document.getElementById('gender').value,
                age: +document.getElementById('age').value,
                height: +document.getElementById('height').value,
                weight: +document.getElementById('currentWeight').value,
                fat: +document.getElementById('bodyFat').value,
                target: +document.getElementById('targetWeight').value,
                activity: +document.getElementById('activityLevel').value
            };
            if(!s.age||!s.height||!s.weight||!s.fat||!s.target) {
                alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            localStorage.setItem('settings',JSON.stringify(s));
            document.getElementById('settingsCard').classList.add('hidden');
            document.getElementById('goalCard').classList.remove('hidden');
            document.getElementById('recordCard').classList.remove('hidden');
            document.getElementById('historyCard').classList.remove('hidden');
            showGoals(s);
            alert('ì„¤ì • ì™„ë£Œ! ğŸ’ª');
        }

        function showSettings() {
            const s = JSON.parse(localStorage.getItem('settings'));
            document.getElementById('gender').value = s.gender;
            document.getElementById('age').value = s.age;
            document.getElementById('height').value = s.height;
            document.getElementById('currentWeight').value = s.weight;
            document.getElementById('bodyFat').value = s.fat;
            document.getElementById('targetWeight').value = s.target;
            document.getElementById('activityLevel').value = s.activity;
            document.getElementById('settingsCard').classList.remove('hidden');
            document.getElementById('goalCard').classList.add('hidden');
            document.getElementById('recordCard').classList.add('hidden');
        }

        function showGoals(s) {
            const bmr = s.gender==='male' ? (10*s.weight)+(6.25*s.height)-(5*s.age)+5 : (10*s.weight)+(6.25*s.height)-(5*s.age)-161;
            const tdee = bmr * s.activity;
            const cal = Math.round(tdee - 500);
            const lm = s.weight * (1 - s.fat/100);
            const pro = Math.round(lm * 2.2);
            const fat = Math.round((cal * 0.27)/9);
            const carb = Math.round((cal - pro*4 - fat*9)/4);
            const diff = s.weight - s.target;
            const days = Math.ceil(diff/0.5)*7;

            document.getElementById('dispCurrent').textContent = s.weight+'kg';
            document.getElementById('dispTarget').textContent = s.target+'kg';
            document.getElementById('dispDiff').textContent = diff.toFixed(1)+'kg';
            document.getElementById('dispDays').textContent = days+'ì¼';
            document.getElementById('dispCal').textContent = cal;
            document.getElementById('dispPro').textContent = pro+'g';
            document.getElementById('dispCarb').textContent = carb+'g';

            // ëª©í‘œê°’ ì €ì¥
            localStorage.setItem('goals', JSON.stringify({cal, pro, carb, fat}));
            updateProgress();
        }

        function updateProgress() {
            const goals = JSON.parse(localStorage.getItem('goals')||'{}');
            if(!goals.cal) return;

            let cal=0, pro=0, carb=0, fat=0;
            Object.values(mealData).forEach(m=>m.forEach(f=>{
                cal+=f.cal;
                pro+=f.pro;
                carb+=f.carb;
                fat+=f.fat;
            }));

            pro = Math.round(pro*10)/10;
            carb = Math.round(carb*10)/10;
            fat = Math.round(fat*10)/10;

            // ëª©í‘œê°’ í‘œì‹œ
            document.getElementById('goalPro').textContent = goals.pro;
            document.getElementById('goalCarb').textContent = goals.carb;
            document.getElementById('goalFat').textContent = goals.fat;
            document.getElementById('goalCal2').textContent = goals.cal;

            // í˜„ì¬ê°’ í‘œì‹œ
            document.getElementById('currentPro').textContent = pro;
            document.getElementById('currentCarb').textContent = carb;
            document.getElementById('currentFat').textContent = fat;
            document.getElementById('currentCal2').textContent = cal;

            // ì§„í–‰ë¥  ê³„ì‚°
            const proPer = Math.min((pro / goals.pro * 100), 100);
            const carbPer = Math.min((carb / goals.carb * 100), 100);
            const fatPer = Math.min((fat / goals.fat * 100), 100);
            const calPer = Math.min((cal / goals.cal * 100), 100);

            // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸
            updateBar('Pro', pro, goals.pro, proPer);
            updateBar('Carb', carb, goals.carb, carbPer);
            updateBar('Fat', fat, goals.fat, fatPer);
            updateBar('Cal', cal, goals.cal, calPer);
        }

        function updateBar(type, current, goal, percent) {
            const bar = document.getElementById('bar'+type);
            const percentSpan = document.getElementById('percent'+type);
            const remain = document.getElementById('remain'+type);
            
            bar.style.width = percent + '%';
            percentSpan.textContent = Math.round(percent) + '%';
            
            const diff = goal - current;
            const isOver = current > goal;
            const isComplete = percent >= 100;

            if(isOver) {
                bar.classList.add('over');
                remain.textContent = `âš ï¸ ${Math.abs(diff).toFixed(1)}${type==='Cal'?'kcal':'g'} ì´ˆê³¼`;
                remain.className = 'remaining-text over';
            } else if(isComplete) {
                remain.textContent = 'âœ… ëª©í‘œ ë‹¬ì„±!';
                remain.className = 'remaining-text complete';
            } else {
                bar.classList.remove('over');
                remain.textContent = `${diff.toFixed(1)}${type==='Cal'?'kcal':'g'} ë‚¨ìŒ`;
                remain.className = 'remaining-text';
            }
        }

        function openMeal(type) {
            currentMeal = type;
            const names = {breakfast:'ì•„ì¹¨',lunch:'ì ì‹¬',dinner:'ì €ë…',snack:'ê°„ì‹'};
            document.getElementById('modalTitle').textContent = names[type]+' ì¶”ê°€';
            document.getElementById('mealModal').style.display = 'block';
            backToMethod();
            updateAdded();
        }

        function closeModal() {
            document.getElementById('mealModal').style.display = 'none';
        }

        function selectMethod(m) {
            document.getElementById('methodSelect').classList.add('hidden');
            if(m==='db') {
                document.getElementById('dbSection').classList.remove('hidden');
                renderFoods();
            } else {
                document.getElementById('manualSection').classList.remove('hidden');
            }
        }

        function backToMethod() {
            document.getElementById('methodSelect').classList.remove('hidden');
            document.getElementById('dbSection').classList.add('hidden');
            document.getElementById('manualSection').classList.add('hidden');
            document.getElementById('amountSection').classList.add('hidden');
            selected = null;
        }

        function renderFoods(q='') {
            const all = [...foodDB,...customDB];
            const filtered = q ? all.filter(f=>f.name.includes(q)) : all;
            document.getElementById('foodList').innerHTML = filtered.map((f,i)=>`
                <div class="food-item" onclick="selectFood(${i})">
                    ${f.photo ? `<img src="${f.photo}" class="food-item-photo">` : ''}
                    <div class="food-item-content">
                        <div class="food-name">${f.name}</div>
                        <div class="food-info">${f.cal}kcal | P:${f.pro}g C:${f.carb}g F:${f.fat}g (100g)</div>
                    </div>
                </div>
            `).join('');
        }

        function searchFood() {
            renderFoods(document.getElementById('foodSearch').value);
        }

        function selectFood(i) {
            const all = [...foodDB,...customDB];
            selected = all[i];
            document.querySelectorAll('.food-item').forEach((el,idx)=>{
                el.classList.toggle('selected',idx===i);
            });
            document.getElementById('amountSection').classList.remove('hidden');
            document.getElementById('foodAmount').value = '100';
        }

        function addFood() {
            if(!selected) return alert('ìŒì‹ì„ ì„ íƒí•˜ì„¸ìš”!');
            const amt = +document.getElementById('foodAmount').value;
            if(!amt) return alert('ì–‘ì„ ì…ë ¥í•˜ì„¸ìš”!');
            const r = amt/100;
            mealData[currentMeal].push({
                name:selected.name,
                amount:amt,
                cal:Math.round(selected.cal*r),
                pro:Math.round(selected.pro*r*10)/10,
                carb:Math.round(selected.carb*r*10)/10,
                fat:Math.round(selected.fat*r*10)/10
            });
            selected = null;
            document.getElementById('foodAmount').value = '';
            document.getElementById('amountSection').classList.add('hidden');
            updateAdded();
            backToMethod();
        }

        function addManual() {
            const name = document.getElementById('manualName').value;
            const amt = +document.getElementById('manualAmount').value;
            const cal = +document.getElementById('manualCal').value;
            const pro = +document.getElementById('manualPro').value;
            const carb = +document.getElementById('manualCarb').value;
            const fat = +document.getElementById('manualFat').value;
            
            if(!name||!amt||cal===undefined||pro===undefined||carb===undefined||fat===undefined) {
                return alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”!');
            }

            if(document.getElementById('saveCustom').checked) {
                const r = 100/amt;
                customDB.push({
                    name,
                    cal:Math.round(cal*r),
                    pro:Math.round(pro*r*10)/10,
                    carb:Math.round(carb*r*10)/10,
                    fat:Math.round(fat*r*10)/10,
                    photo: manualPhotoData
                });
                localStorage.setItem('customFoods',JSON.stringify(customDB));
            }

            mealData[currentMeal].push({name,amount:amt,cal:Math.round(cal),pro:Math.round(pro*10)/10,carb:Math.round(carb*10)/10,fat:Math.round(fat*10)/10});
            
            document.getElementById('manualName').value = '';
            document.getElementById('manualAmount').value = '';
            document.getElementById('manualCal').value = '';
            document.getElementById('manualPro').value = '';
            document.getElementById('manualCarb').value = '';
            document.getElementById('manualFat').value = '';
            document.getElementById('saveCustom').checked = false;
            document.getElementById('manualPhoto').value = '';
            document.getElementById('manualPhotoPreview').innerHTML = '';
            manualPhotoData = null;

            updateAdded();
            backToMethod();
        }

        function updateAdded() {
            const foods = mealData[currentMeal];
            const pics = photos[currentMeal];
            
            if(foods.length===0 && pics.length===0) {
                document.getElementById('addedSection').classList.add('hidden');
                return;
            }

            document.getElementById('addedSection').classList.remove('hidden');
            let html = '';
            
            if(pics.length>0) {
                html += '<div style="margin-bottom:15px;"><strong>ì‚¬ì§„</strong><div class="photo-grid">';
                pics.forEach(p=>html+=`<img src="${p}" class="photo-item">`);
                html += '</div></div>';
            }

            if(foods.length>0) {
                html += '<div><strong>ìŒì‹</strong>';
                foods.forEach((f,i)=>html+=`
                    <div class="added-item">
                        <div>
                            <div style="font-weight:700;">${f.name} (${f.amount}g)</div>
                            <div style="font-size:0.85rem;opacity:0.8;">${f.cal}kcal | P:${f.pro}g C:${f.carb}g F:${f.fat}g</div>
                        </div>
                        <button onclick="removeFood(${i})" style="background:#ff6b6b;color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;">ì‚­ì œ</button>
                    </div>
                `);
                html += '</div>';
            }

            document.getElementById('addedList').innerHTML = html;
        }

        function removeFood(i) {
            mealData[currentMeal].splice(i,1);
            updateAdded();
        }

        function addPhoto() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = e => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = ev => {
                        photos[currentMeal].push(ev.target.result);
                        updateAdded();
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function saveMeal() {
            updateCounts();
            updateTotals();
            updatePhotos();
            closeModal();
        }

        function updateCounts() {
            document.getElementById('breakfastCount').textContent = `(${mealData.breakfast.length})`;
            document.getElementById('lunchCount').textContent = `(${mealData.lunch.length})`;
            document.getElementById('dinnerCount').textContent = `(${mealData.dinner.length})`;
            document.getElementById('snackCount').textContent = `(${mealData.snack.length})`;
        }

        function updateTotals() {
            let cal=0,pro=0,carb=0,fat=0;
            Object.values(mealData).forEach(m=>m.forEach(f=>{
                cal+=f.cal;
                pro+=f.pro;
                carb+=f.carb;
                fat+=f.fat;
            }));
            document.getElementById('totalCal').textContent = cal;
            document.getElementById('totalPro').textContent = Math.round(pro*10)/10+'g';
            document.getElementById('totalCarb').textContent = Math.round(carb*10)/10+'g';
            
            updateProgress();
        }

        function updatePhotos() {
            const all = [...photos.breakfast,...photos.lunch,...photos.dinner,...photos.snack];
            if(all.length>0) {
                document.getElementById('photoSection').classList.remove('hidden');
                document.getElementById('photoGrid').innerHTML = all.map(p=>`<img src="${p}" class="photo-item">`).join('');
            } else {
                document.getElementById('photoSection').classList.add('hidden');
            }
        }

        function saveRecord() {
            const w = document.getElementById('todayWeight').value;
            if(!w) return alert('ì²´ì¤‘ì„ ì…ë ¥í•˜ì„¸ìš”!');

            let cal=0,pro=0,carb=0,fat=0;
            Object.values(mealData).forEach(m=>m.forEach(f=>{
                cal+=f.cal;
                pro+=f.pro;
                carb+=f.carb;
                fat+=f.fat;
            }));

            const rec = {
                date: new Date().toISOString(),
                weight: +w,
                meals: JSON.parse(JSON.stringify(mealData)),
                photos: JSON.parse(JSON.stringify(photos)),
                cal, pro: Math.round(pro*10)/10, carb: Math.round(carb*10)/10, fat: Math.round(fat*10)/10,
                exercise: document.getElementById('exercise').checked,
                memo: document.getElementById('memo').value
            };

            let recs = JSON.parse(localStorage.getItem('records')||'[]');
            recs.unshift(rec);
            localStorage.setItem('records',JSON.stringify(recs));

            document.getElementById('todayWeight').value = '';
            document.getElementById('exercise').checked = false;
            document.getElementById('memo').value = '';
            mealData = {breakfast:[],lunch:[],dinner:[],snack:[]};
            photos = {breakfast:[],lunch:[],dinner:[],snack:[]};
            updateCounts();
            updateTotals();
            updatePhotos();
            loadHistory();
            alert('ê¸°ë¡ ì™„ë£Œ! ğŸ’ª');
        }

        function loadHistory() {
            const recs = JSON.parse(localStorage.getItem('records')||'[]');
            if(recs.length===0) {
                document.getElementById('historyList').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            document.getElementById('historyList').innerHTML = recs.map(r=>{
                const d = new Date(r.date);
                const ds = d.toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric',weekday:'short'});
                let html = `<div class="history-item"><div class="history-date">${ds}</div>`;
                
                if(r.photos) {
                    const allP = [...(r.photos.breakfast||[]),...(r.photos.lunch||[]),...(r.photos.dinner||[]),...(r.photos.snack||[])];
                    if(allP.length>0) {
                        html += '<div class="photo-grid" style="margin:10px 0;">';
                        allP.forEach(p=>html+=`<img src="${p}" style="width:80px;height:80px;object-fit:cover;border-radius:8px;">`);
                        html += '</div>';
                    }
                }
                
                html += `<div class="history-grid">
                    <div>ì²´ì¤‘: <strong>${r.weight}kg</strong></div>
                    <div>ì¹¼ë¡œë¦¬: <strong>${r.cal}kcal</strong></div>
                    <div>ë‹¨ë°±ì§ˆ: <strong>${r.pro}g</strong></div>
                    <div>íƒ„ìˆ˜í™”ë¬¼: <strong>${r.carb}g</strong></div>
                    <div>ì§€ë°©: <strong>${r.fat||0}g</strong></div>
                    <div>ìš´ë™: <strong>${r.exercise?'âœ…':'âŒ'}</strong></div>
                </div>`;
                
                if(r.memo) html += `<div style="margin-top:10px;padding-top:10px;border-top:1px solid #e0e0e0;font-size:0.9rem;color:#666;">${r.memo}</div>`;
                html += '</div>';
                return html;
            }).join('');
        }

        function clearAll() {
            if(confirm('ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('records');
                loadHistory();
            }
        }

        let weeklyChart = null;
        let monthlyChart = null;

        function showTab(tab) {
            document.getElementById('dailyTab').classList.toggle('hidden', tab !== 'daily');
            document.getElementById('weeklyTab').classList.toggle('hidden', tab !== 'weekly');
            document.getElementById('monthlyTab').classList.toggle('hidden', tab !== 'monthly');
            
            document.getElementById('tabDaily').style.background = tab === 'daily' ? 'var(--accent)' : '#e0e0e0';
            document.getElementById('tabDaily').style.color = tab === 'daily' ? 'white' : 'var(--primary)';
            document.getElementById('tabWeekly').style.background = tab === 'weekly' ? 'var(--accent)' : '#e0e0e0';
            document.getElementById('tabWeekly').style.color = tab === 'weekly' ? 'white' : 'var(--primary)';
            document.getElementById('tabMonthly').style.background = tab === 'monthly' ? 'var(--accent)' : '#e0e0e0';
            document.getElementById('tabMonthly').style.color = tab === 'monthly' ? 'white' : 'var(--primary)';

            if(tab === 'weekly') showWeeklyStats();
            if(tab === 'monthly') showMonthlyStats();
        }

        function showWeeklyStats() {
            const recs = JSON.parse(localStorage.getItem('records')||'[]');
            if(recs.length === 0) {
                document.getElementById('weeklyStats').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            // ìµœê·¼ 7ì¼ ë°ì´í„°
            const last7 = recs.slice(0, 7).reverse();
            const dates = last7.map(r => new Date(r.date).toLocaleDateString('ko-KR', {month:'short',day:'numeric'}));
            const weights = last7.map(r => r.weight);
            const cals = last7.map(r => r.cal);

            if(weeklyChart) weeklyChart.destroy();

            const ctx = document.getElementById('weeklyChart').getContext('2d');
            weeklyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'ì²´ì¤‘ (kg)',
                        data: weights,
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255,107,107,0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'ì¹¼ë¡œë¦¬ (kcal)',
                        data: cals,
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78,205,196,0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'ì²´ì¤‘ (kg)' }},
                        y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'ì¹¼ë¡œë¦¬ (kcal)' }, grid: { drawOnChartArea: false }}
                    }
                }
            });

            // ì£¼ê°„ í†µê³„
            const avgWeight = (weights.reduce((a,b)=>a+b,0)/weights.length).toFixed(1);
            const avgCal = Math.round(cals.reduce((a,b)=>a+b,0)/cals.length);
            const weightChange = (weights[weights.length-1] - weights[0]).toFixed(1);
            const exerciseDays = last7.filter(r=>r.exercise).length;

            document.getElementById('weeklyStats').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  ì²´ì¤‘</div>
                        <div class="stat-value">${avgWeight}kg</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">ì²´ì¤‘ ë³€í™”</div>
                        <div class="stat-value">${weightChange>0?'+':''}${weightChange}kg</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  ì¹¼ë¡œë¦¬</div>
                        <div class="stat-value">${avgCal}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">ìš´ë™ ì¼ìˆ˜</div>
                        <div class="stat-value">${exerciseDays}ì¼</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  ë‹¨ë°±ì§ˆ</div>
                        <div class="stat-value">${(last7.reduce((a,r)=>a+r.pro,0)/last7.length).toFixed(1)}g</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  íƒ„ìˆ˜í™”ë¬¼</div>
                        <div class="stat-value">${(last7.reduce((a,r)=>a+r.carb,0)/last7.length).toFixed(1)}g</div>
                    </div>
                </div>
            `;
        }

        function showMonthlyStats() {
            const recs = JSON.parse(localStorage.getItem('records')||'[]');
            if(recs.length === 0) {
                document.getElementById('monthlyStats').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            // ìµœê·¼ 30ì¼ ë°ì´í„°
            const last30 = recs.slice(0, 30).reverse();
            const dates = last30.map(r => new Date(r.date).toLocaleDateString('ko-KR', {month:'short',day:'numeric'}));
            const weights = last30.map(r => r.weight);
            const cals = last30.map(r => r.cal);

            if(monthlyChart) monthlyChart.destroy();

            const ctx = document.getElementById('monthlyChart').getContext('2d');
            monthlyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'ì²´ì¤‘ (kg)',
                        data: weights,
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255,107,107,0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'ì¹¼ë¡œë¦¬ (kcal)',
                        data: cals,
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78,205,196,0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'ì²´ì¤‘ (kg)' }},
                        y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'ì¹¼ë¡œë¦¬ (kcal)' }, grid: { drawOnChartArea: false }}
                    }
                }
            });

            // ì›”ê°„ í†µê³„
            const avgWeight = (weights.reduce((a,b)=>a+b,0)/weights.length).toFixed(1);
            const avgCal = Math.round(cals.reduce((a,b)=>a+b,0)/cals.length);
            const weightChange = (weights[weights.length-1] - weights[0]).toFixed(1);
            const exerciseDays = last30.filter(r=>r.exercise).length;
            const totalDays = last30.length;

            document.getElementById('monthlyStats').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  ì²´ì¤‘</div>
                        <div class="stat-value">${avgWeight}kg</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">ì²´ì¤‘ ë³€í™”</div>
                        <div class="stat-value">${weightChange>0?'+':''}${weightChange}kg</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  ì¹¼ë¡œë¦¬</div>
                        <div class="stat-value">${avgCal}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">ìš´ë™ ì¼ìˆ˜</div>
                        <div class="stat-value">${exerciseDays}/${totalDays}ì¼</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  ë‹¨ë°±ì§ˆ</div>
                        <div class="stat-value">${(last30.reduce((a,r)=>a+r.pro,0)/last30.length).toFixed(1)}g</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">í‰ê·  íƒ„ìˆ˜í™”ë¬¼</div>
                        <div class="stat-value">${(last30.reduce((a,r)=>a+r.carb,0)/last30.length).toFixed(1)}g</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">ğŸ“ˆ í•œ ë‹¬ ìš”ì•½</h3>
                    <div style="display: grid; gap: 10px; font-size: 0.95rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>ì´ ê¸°ë¡ ì¼ìˆ˜:</span>
                            <strong>${totalDays}ì¼</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>ìš´ë™ ë‹¬ì„±ë¥ :</span>
                            <strong>${Math.round(exerciseDays/totalDays*100)}%</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>ìµœê³  ì²´ì¤‘:</span>
                            <strong>${Math.max(...weights)}kg</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>ìµœì € ì²´ì¤‘:</span>
                            <strong>${Math.min(...weights)}kg</strong>
                        </div>
                    </div>
                </div>
            `;
        }

        init();
    </script>
    <script>
        // PWA Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed'));
            });
        }

        // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // ì„¤ì¹˜ ì•ˆë‚´ í‘œì‹œ
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 9999; text-align: center;">
                    <p style="margin-bottom: 15px; font-weight: 700; color: var(--primary);">ğŸ“± ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ì‹œê² ì–´ìš”?</p>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="installPWA()" style="flex: 1; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer;">ì„¤ì¹˜í•˜ê¸°</button>
                        <button onclick="closeBanner()" style="flex: 1; padding: 12px; background: #e0e0e0; color: var(--primary); border: none; border-radius: 10px; font-weight: 700; cursor: pointer;">ë‚˜ì¤‘ì—</button>
                    </div>
                </div>
            `;
            installBanner.id = 'installBanner';
            document.body.appendChild(installBanner);
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                    closeBanner();
                });
            }
        }

        function closeBanner() {
            const banner = document.getElementById('installBanner');
            if (banner) banner.remove();
        }
    </script>
</body>
</html>